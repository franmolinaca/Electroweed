\documentclass[letterpaper]{article}
\usepackage[utf8]{inputenc}
%\usepackage[ansinew]{inputenc}
\usepackage[spanish]{babel}
\usepackage{graphicx}

\begin{document}

\title{Anteproyecto 4\\ Laboratorio de Control de servomotores}
\author{
 Marco Antonio Montero Chavarría Carné: A94000\\
  \and
  Francisco Molina Carné: B14194\\  
}
\maketitle

\section{Investigación Previa}
\subsection{Servomotor}
 Un servomotor mejor conocido como servo es un dispositivo similar a un motor DC que tiene la capacidad de ubicarse en cualquier posición dentro de su rango de operación y mantenerse estable en dicha posición. Por lo tanto es un motor eléctrico al que se le puede controlar tanto la posición como la velocidad.\\
 Esta conformado por un motor, una caja reductora y un circuito de control. En otras palabras un servo es un motor especial al que se le ha añadido un sistema de control, un potenciómetro y un conjunto de engranajes.\\
 Los servos hacen uso de la modulación por ancho de pulsos (PWM) para controlar la dirección o posición de los motores DC. La electrónica dentro del servomotor responderá al ancho de la señal modulada. 
\subsection{PWM}
 La modulación por ancho de pulsos conocida como PWM, es una técnica en la que se modifica el ciclo de trabajo de una señal que sea periódica, ya sea para transmisión de información a través de un canal de comunicaciones o para controlar la cantidad de energía que se envía a una carga. Se tiene:\\
$D= \frac{ \tau }{T}$\\
Donde D es el ciclo de trabajo, $\tau$ es el tiempo en que la función es positiva y T es el período de la función.\\
La construcción típica de un circuito PWM se lleva a cabo mediante un comparador con dos entradas y una salida. Una de las entradas se conecta a un oscilador de onda de dientes de sierra, mientras que la otra queda disponible para la señal moduladora. En la salida la frecuencia es generalmente igual a la de la señal diente de sierra y el ciclo de trabajo está en función de la señal portador.\\
\subsection{PID}
 Un controlador PID es un mecanismo de control con una realimentación que se utiliza en control industrial o automático. Calcula la desviación o error entre un valor medido y un valor deseado.\\
 El algoritmo de control PID consta de tres parámetros importantes: el proporcional, el integral y el derivativo. El valor Proporcional depende del error actual. El integral depende de los errores pasados y el Derivativo es una predicción de los errores futuros. La suma de estos tres es usada para ajustar el proceso por medio de un elemento de control como la tensión en un calentador.\cite{1}\\

\begin{figure}[hbtp]
\centering
\includegraphics[width=10 cm]{PID.png}
\caption{Esquema PID}
\label{PID}
\end{figure}



\newpage
\section{Solución Propuesta}

Primero se ocupa un programa que lea valores de velocidad y posición del servomotor, esto se puede lograr con un programa que lea los pines de entrada que se definan para controlar el servomotor, este programa debe ser hecho en C, y es muy parecido al programa que se utilizó en el proyecto 3 que lee los pines PA0,PA1,PA2; con la adición en el programa de un método que modifique los valores del PWM de salida para que se ajuste la posición y velocidad que se busca en el servo. En resumen habrá una comunicación bidireccional entre el microcontrolador y el servomotor, ya que el STM32f4 deberá controlar el servo y además tomar la información cuasi-inmediata de las variables de interés del servomotor.\\
Luego se necesita montar una conexión entre el microcontrolador y la computadora con un programa en python que sea capaz de enviar 2 valores por micro-usb al microcontrolador, que sean generados por el usuario. Aquí habrá que buscar una relación entre el código implementado en python y el código implementado en C. Esto se puede lograr con la librería usada en el proyecto anterior -pyserial- ya que tiene opciones de envio al puerto designado para comunicación serial. Por lo tanto por el micro-usb se comunicará el programa del usuario que envia el dato de velocidad y posición que se desea y luego el programa en C flasheado en el -stm32f4- enviará la respuesta por ese mismo medio.\\
Naturalmente para evitar conflicto entre ambas comunicaciones se necesitará correcto uso de los métodos para cerrar y abrir la comunicación entre el microcontrolador y el computador que se este utilizando para enviar y recibir los valores.\\
Por último con la librería matplotlib se pueden tomar los valores recibidos del microcontrolador y gráficarlos contra el tiempo para observar su variación.\\

\begin{center}
\includegraphics[width=2cm]{micro.png}
\end{center}

El otro problema del proyecto es la parte física electrónica, ya que el PWM con el que se debe manipular la velocidad y posición del servomotor, necesita valores entre 0 y 5V y lo máximo que se puede obtener directamente del -stm- es 0-3V por lo tanto se debe utilizar un amplificador operacional en configuración de amplificador no inversor con alimentación de 5V, esto para llegar a obtener el rango deseado para el PWM. Una configuración como esta luce de la siguiente forma:\\

\begin{center}
\includegraphics[width=5cm]{amp.png}
\end{center}

Los valores de las resistencias se ajustarán según el valor real que se tenga en el laboratorio para obtener el rango deseado en la salida de la configuración no inversor.

\section{Procedimiento}
\begin{itemize}
\item Crear el código en python para comunicación serial y graficación.
\item Crear el código en c que tome los datos enviados por comunicación serial y que envié el PWM y tome datos de salida del servo.
\item Crear el circuito físico del amplificador operacional no inversor para lograr el rango de PWM deseado.
\end{itemize}

\section{Observaciones y recomendaciones}

\begin{itemize}
\item Tener sumo cuidado con el circuito de protección, probar que las tensiones sean las adecuadas.
\item Realizar pequeñas pruebas antes de programar cada parte y descomponer el problema en problemas más sencillos.
\item Probar el circuito de amplificación por fuera con un generador de señales para no quemar el STM32f4 por un pico de tensión en caso de un error en el diseño de la configuración amplificadora.
\end{itemize}

\bibliographystyle{alpha} 
\bibliography{refs}



\end{document}
